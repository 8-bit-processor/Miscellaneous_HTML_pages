<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress Note Studio</title>
    <style>
body {
    font-family: sans-serif;
    background-color: #f4f4f4;
    margin: 0;
    padding: 0;
}

header {
    background-color: #333;
    color: white;
    padding: 10px 20px;
    text-align: center;
}

.container {
    display: flex;
    height: calc(100vh - 50px);
}

#sidebar {
    width: 250px;
    background-color: #f0f0f0;
    padding: 20px;
    border-right: 1px solid #ccc;
    overflow-y: auto;
}

#main-content {
    flex-grow: 1;
    padding: 20px;
    overflow-y: auto;
}

#notes-container {
    height: calc(100% - 150px);
    overflow-y: scroll;
    margin-bottom: 20px;
    border: 1px solid #ccc;
    padding: 10px;
}

.note {
    display: flex;
    flex-direction: column;
    margin-bottom: 10px;
}

.note input[type="text"] {
    font-weight: bold;
    font-size: 1.1em;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 3px;
    margin-bottom: 5px;
}

.note textarea {
    flex-grow: 1;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 3px;
    resize: vertical;
    min-height: 100px;
    width: calc(100% - 22px); /* Adjust for padding and border */
}

.note button {
    background-color: #f44336;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 3px;
    cursor: pointer;
    margin-top: 5px;
    width: 100px;
    align-self: flex-end;
}

#controls {
    margin-top: 20px;
}

#add-note, #save-notes, #save-as-button, #load-button, #import-button, #copy-to-clipboard, .lab-formatter-button {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 3px;
    cursor: pointer;
    margin-right: 10px;
}

.lab-formatter-button {
    background-color: #2196F3;
}

#notes-index {
    list-style-type: none;
    padding: 0;
}

#notes-index li {
    padding: 5px;
    cursor: pointer;
}

.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto; /* 15% from the top and centered */
    padding: 20px;
    border: 1px solid #888;
    width: 80%; /* Could be more or less, depending on screen size */
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

#notes-index li:hover {
    background-color: #ddd;
}
    </style>
</head>
<body>
    <header>
        <h1>Progress Note Studio</h1>
    </header>
    <div class="container">
        <aside id="sidebar">
            <h2>Section Index</h2>
            <ul id="notes-index"></ul>
            <hr>
            <h2>Import Window</h2>
            <textarea id="import-textarea" placeholder="Paste your document here..."></textarea>
        </aside>
        <main id="main-content">
            <div id="notes-container"></div>
            <div id="controls">
                <button id="add-note">Add Note Section</button>
                <button id="copy-to-clipboard">Copy Document to Clipboard</button>
                <button id="open-lab-formatter" class="lab-formatter-button">Lab Formatter</button>
            </div>
        </main>
    </div>
    <div id="lab-formatter-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="lab-formatter-container">
	<input type="text" id="clipb" onpaste="handlePaste()" placeholder="Paste lab data here...">
	<div id="edtData" contenteditable="true"></div>
	<table id="trendTable"></table>
</div>
        </div>
    </div>
    <script>
var vals = {};
var listVals = {};
var listCrit = {};
var listUH = {};
var listPH = {};
var listTime = {};
var listSpecimen = {};
var listMicro = new Array();
var listMicroSpec = new Array();
var medList = new Array();
var replaceArray = new Array();
var msDay = 86400000;
var cbcData = "";
var chemistryData = "";
var urineData = "";
var pleuralData = "";
var peritonealData = "";
var cexclude = "||";
var uexclude = "||";
var csfData = "";
var otherData = "";
var listComment = {};
var blankLength = 55;
var numberMeds = 0;
var calledMeds = 0;
var medListOutpatient = false;
//UPMC CHANGES
replaceArray["CREATININE-e"] = "Creatinine";
replaceArray["TOTAL BILIRUBIN"] = "TBil";
replaceArray["DIRECT BILIRUBIN"] = "DBil";
replaceArray["ALP"] = "ALK";
replaceArray["TOTAL PROTEIN,SERUM"] = "Protein";
replaceArray["LIPASE (LX)"] = "Lipase";
replaceArray["HGB A1C"] = "A1c";

//Chemistries
replaceArray["IRON"] = "Iron";
replaceArray["TIBC"] = "TIBC";
replaceArray["IRON SATURATION"] = "Iron sat";
replaceArray["FOLATE,SERUM"] = "Serum folate";
replaceArray["FOLATE,SERUM(pre 9-27-05)"] = replaceArray["FOLATE,SERUM"];
replaceArray["CALCIUM"] = "Calcium";
replaceArray["MAGNESIUM"] = "Mag";
replaceArray["PO4,SERUM"] = "Phos";
replaceArray["PHOSPHORUS"] = "Phos";
replaceArray["TROPONIN I"] = "Trop I";
replaceArray["FERRITIN"] = "Ferritin";
replaceArray["D-DIMER"] = "D-dimer";
replaceArray["ALPHA-FETOPROTEIN"] = "AFP";
replaceArray["PROSTATIC SPECIFIC ANTIGEN"] = "PSA";
replaceArray["METHYLMALONIC ACID (SERUM)"] = "Serum MMA";
replaceArray["HEMOGLOBIN A1C"] = "A1c";
replaceArray["EST.AVERAGE GLUCOSE"] = "Est Avg Glucose";
replaceArray["URIC ACID"] = "Uric Acid";
replaceArray["OSMOLALITY"] = "Osmolality";
replaceArray["PREALBUMIN"] = "Prealbumin";
replaceArray["B-HYDROXYBUTYRATE"] = "B-Hydroxybutyrate"
replaceArray["CALCIUM,FREE (WHAV)"] = "iCal";
replaceArray["ALBUMIN"] = "Albumin";
replaceArray["GLU POC"] = "Glucose";
replaceArray["GLUCOSE"] = "Glucose";
replaceArray["ANCILLARY GLUCOSE"] = "Glucose";
replaceArray["Hct (Quest)"] = "HCT";
replaceArray["HEMATOCRIT"] = "HCT";
replaceArray["zz-CPK (WHAV)pre4-24-01"] = "CPK";
replaceArray["FASTING GLUCOSE"] = "Fasting Glucose";
replaceArray["TROPONIN-I (10/1/99-11/5/00)"] = "Trop I";
replaceArray["TROPONIN-I (DC'D 7-26-10)"] = "Trop I";
replaceArray["LACTIC"] = "Lactate";
replaceArray["eGFR(IDMS)"] = "eGFR";
replaceArray["eGFR(DC'D 4-16-10)"] = "eGFR";
replaceArray["LACTIC ACID"] = "Lactate";
replaceArray["TROPONIN-I (11/6/00-11/6/01)"] = "Trop I";
replaceArray["bnp"] = "BNP";
replaceArray["MB-Ag"] = "CK-MB";
replaceArray["CALCIUM,FREE (NEWT)"] = "iCal";
replaceArray["PROCALCITONIN"] = "Procal";
replaceArray["MB-Ag(DC'D 10/3/16)"] = "MB-Ag";
replaceArray["(WRX) PROTEIN,SERUM"] = "Protein";
replaceArray["PROTEIN, TOTAL"] = "Protein";
replaceArray["ALBUMIN,ELECT."] = "Albumin";
replaceArray["DC'D PROCAL"] = "Procal";
replaceArray["URIC ACID,URINE RANDOM"] = "Uric acid, random";
replaceArray["TPMT"]  = "TPMT";
replaceArray["LIPASE (WHAV)DC'd 7-13-99"];
replaceArray["CREATININE,SERUM"] = "Creatinine";
replaceArray["CREATININE"] = "Creatinine";
replaceArray["CARBON DIOXIDE"] = "CO2";
replaceArray["ALT(SGPT)"] = "ALT";
replaceArray["AST(SGOT)"] = "AST";
replaceArray["VITAMIN B-12"] = "B12";
//Urine
replaceArray["SODIUM,URINE"] = "Na";
replaceArray["CREATININE,URINE"] = "Creatinine";
replaceArray["PROTEIN,URINE"] = "Protein";
replaceArray["miCROALB./CREAT RATIO-SPOT"] = "Spot Albumin/Cr ratio";
replaceArray["UREA NITROGEN,URINE"] = "Urea nitrogen";
replaceArray["CREATININE, URINE RANDOM"] = "Creatinine";
replaceArray["POTASSIUM,URINE"] = "Potassium";
replaceArray["CHLORIDE,URINE"] = "Chloride";
replaceArray["CRYSTALS"] = "Crystals";
replaceArray["EOSINOPHILS,URINE"] = "Eosinophils";
replaceArray["miCROALBUMIN,24-HR"] = "24h Albumin";
replaceArray["miCROALB/CREAT RATIO-24 HR"] = "24h Albumin/Cr";
replaceArray["VOLUME"] = "Urine Volume";
replaceArray["CALCIUM,URINE"] = "Calcium";
replaceArray["MAGNESIUM,RANDOM UR"] = "Magnesium";
replaceArray["CREATININE,RANDOM UR"] = "Creatinine";
replaceArray["CREATININE (URINE,RANDOM)"] = "Creatinine";
replaceArray["AM PHOSPHATE CRYSTALS"] = "Phosphate Crystals"

//Liver
replaceArray["GAMMA GLUTAMYLTRANSFERASE"] = "GGT";
replaceArray["AMMONIA"] = "Ammonia";
replaceArray["SMMUSC"] = "Anti-Smooth Muscle";
replaceArray["ANTI-LKM"] = "Anti-LKM";
replaceArray["SGOT (NEWT)pre 4-2-01"] = "AST";
replaceArray["SGPT (NEWT)pre 4-2-01"] = "ALT";
replaceArray["ALKALINE PHOSPHATASE"] = "ALK";
replaceArray["TOT. BILIRUBIN"] = "TBil";
replaceArray["BILIRUBIN, TOTAL"] = "TBil";
replaceArray["DIR. BILIRUBIN"] = "DBil";
replaceArray["SGOT (WHAV)pre 4-24-01"] = "AST";
replaceArray["SGPT (WHAV)pre 4-24-01"] = "ALT";
replaceArray["AMYLASE"] = "Amylase";
replaceArray["LIPASE"] = "Lipase";
replaceArray["LIPASE (WHAV) DC'd 4-23-01"] = replaceArray["LIPASE"];
replaceArray["ALK PHO"] = "ALK";
replaceArray["AMYLASE (WHAV) pre 4-23-01"] = replaceArray["AMYLASE"];
replaceArray["ALPHA-1 ANTITRYPSIN"] = "Alpha-1 antitrypsin";
replaceArray["AMMONIA (WHAV)pre 4-24-01"] = "Ammonia";
replaceArray["INTRINSIC FACTOR AB"] = "Intrinsic Factor Ab";
replaceArray["ENDOMYSIAL AB IGA"] = "Endomysial Ab IgA";
replaceArray["ENDOMYSIAL AB TITER"] = "Endomysial Ab Titer"
replaceArray["CD IN"] = "Celiac interp";
replaceArray["CERULOPLASMIN"] = "Ceruloplasmin";
replaceArray["HFEgene"] = "HFE gene";

//Endocrine
replaceArray["RENIN ACTIVITY(PRA)"] = "Renin activity";
replaceArray["ALDOSTERONE,PLASMA"] = "Aldosterone";
replaceArray["ALDOSTERONE/RENIN RATIO"] = "Aldosterone/renin";
replaceArray["NOREPINEPHRINE"] = "Norepinephrine";
replaceArray["DOPAMINE"] = "Dopamine";
replaceArray["EPINEPHRINE"] = "Epinephrine";
replaceArray["TOT.CATECHOLAMINES"] = "Catecholamines";
replaceArray["FRUCTOSAMINE"] = "Fructosamine";
replaceArray["shbg"] = "SHBG";
replaceArray["D TOT"] = "Total Vit D";
replaceArray["VITAMIN D,TOTAL(SCREEN)"] = "Total Vit D";
replaceArray["VITAMIN D TOTAL(SCREEN)"] = "Total Vit D";
replaceArray["VIT D 25-OH(WRJ)"] = "Total Vit D";
replaceArray["vIT D 25-OH,TOT(Rx Monitor)"] = "Total Vit D";
replaceArray["vIT D 25-0H,D2(Rx Monitor)"] = "Vit D2";
replaceArray["vIT D 25-OH,D3(Rx Monitor)"] = "Vit D3";
replaceArray["FREE T3"] = "Free T3";
replaceArray["C-PEPTIDE"] = "C-Peptide";
replaceArray["INSULIN AUTOANTIBODY"] = "Insulin autoantibody";
replaceArray["ANTI GAD 65"] = "Anti-GAD65";
replaceArray["PTH (INTACT) D'CD 3-30-15"] = "PTH";
replaceArray["PTH (INTACT)QUEST"] = "PTH";
replaceArray["PTH (INTACT)"] = "PTH";
replaceArray["ESTRONE"] = "Estrone";
replaceArray["CORTISOL PM"] = "Cortisol PM";
replaceArray["DHEA-S"] = "DHEA";
replaceArray["DHEA"] = "DHEA";
replaceArray["ACTH"] = "ACTH";
replaceArray["ALDO-S"] = "Aldosterone";
replaceArray["ZZTESTO"] = "Total Testosterone";
replaceArray["T4,FREE"] = "Free T4";
replaceArray["T-4"] = "T-4";
replaceArray["Testo,Tot Sendout"] = "Total Testosterone";
replaceArray["ESTRADIOL(pre 2-24-05)"] = "Estradiol";
replaceArray["ESTRADIOL"] = "Estradiol";
replaceArray["Testosterone, FREE(SENDOUT)"] = "Free Testosterone";
replaceArray["fR TEST"] = "Free Testosterone";
replaceArray["T%UPTAKE"] = "Thyroid uptake %";
replaceArray["T%UPTAKE(pre 4-16-01)"] = replaceArray["T%UPTAKE"];
replaceArray["tESTO F"] = "Free Testosterone";
replaceArray["FTI(pre 4-16-01)"] = "FTI";
replaceArray["tESTOSTERONE,TOTAL (12-1-97)"] = "Total Testosterone";
replaceArray["ALDOSTERONE,SERUM"] = "Aldosterone";
replaceArray["PROLACTIN"] = "Prolactin";
replaceArray["PTH (INTACT)pre 1-2-03"] = "PTH";
replaceArray["THYROID PEROXIDASE AB"] = "Thyroperoxidase Ab";
replaceArray["ANTI-THYROGLOBULIN AB"] = "Anti-Thyroglobulin Ab";
replaceArray["PTH RELATED PROTEIN"] = "PTHrP";
replaceArray["CALCITONIN"] = "Calcitonin";
replaceArray["CORTISOL AM"] = "Cortisol AM";
replaceArray["ERYTHROPOIETIN"] = "Epo";


//Heme
replaceArray["PLT-AUTO"] = "PLT";
replaceArray["A/G RATIO(EP)"] = "A/G Ratio";
replaceArray["GAMMA GLOBULIN(EP)"] = "G Globulin";
replaceArray["BETA GLOBULIN(EP)"] = "B Globulin";
replaceArray["ALPHA2 GLOBULIN(EP)"] = "A2 Globulin";
replaceArray["ALPHA1 GLOBULIN(EP)"] = "A1 Globulin";
replaceArray["ALBUMIN(EP)"] = "Albumin";
replaceArray["PROTEIN,TOTAL(EP)"]="Protein";

replaceArray["FREE K/L LC RATIO"] = "Free K/L Ratio";
replaceArray["FREE K/L RATIO(b)"] = "Free K/L Ratio";
replaceArray["KAPPA LC FREE SERUM"] = "Free Kappa LC";
replaceArray["KAPPA LC FREE SERUM(b)"] = "Free Kappa LC";
replaceArray["LAMBDA LC FREE SERUM"] = "Free Lambda LC";
replaceArray["LAMBDA LC FREE SERUM(b)"] = "Free Lambda LC";
replaceArray["KAPPA,SERUM QNT"] = "Total Kappa LC";
replaceArray["LAMBDA,SERUM QUANT"] = "Total Lambda LC";
replaceArray["KAPPA/LAMBDA RATIO,SERUM"] = "Total K/L Ratio";
replaceArray["IGA,SERUM"] = "IgA";
replaceArray["IGG,SERUM"] = "IgG";
replaceArray["IGM,SERUM"] = "IgM";
replaceArray["IGE,SERUM"] = "IgE";

replaceArray["BETA 2 GLYCOP,IGG"] = "B2 Glycoprotein IgG";
replaceArray["BETA 2 GLYCOP,IGM"] = "B2 Glycoprotein IgM";
replaceArray["BETA 2 GLYCOP,IGA"] = "B2 Glycoprotein IgA";
replaceArray["CAR IgG"] = "Cardiolipin IgG";
replaceArray["CAR IgM"] = "Cardiolipin IgM";
replaceArray["HAPTOGLOBIN"] = "Haptoglobin";
replaceArray["HEMOGLOBIN A"] = "HGB A";
replaceArray["HEMOGLOBIN F"] = "HGB F"
replaceArray["HEMOGLOBIN A2"] = "HGB A2"
replaceArray["HGB SCREEN"] = "HGB Screen";
replaceArray["HGB REVIEWER"] = "HGB Reviewer";

replaceArray["SEROTONIN RELEASE ASSAY"] = "Serotonin release";
replaceArray["PATIENT OD"] = "HIT Ab OD";
replaceArray["BETA 2 MICROGLOBULIN,SERUM"] = "B2 Microglobulin";
replaceArray["RETICULATED PLATELET(YALE)"] = "Retic PLT";
replaceArray["WBC (FCM)"] = "WBC";
replaceArray["LYMPH % (FCM)"] = "Lymph";
replaceArray["ABS LYMPH (FCM)"] = "ABSOLUTE LYMPHOCYTE COUNT";
replaceArray["DC'D K/L"] = "Total K/L Ratio";
replaceArray["IGA"] = "IgA";
replaceArray["IGM"] = "IgM";
replaceArray["IGG"] = "IgG";
replaceArray["DC'D LAMBDA"] = "Total Lambda LC";
replaceArray["KAPPA QNT,SERUM DC'D 4/13/15"] = "Total Kappa LC";
replaceArray["RETICULOCYTES (%)"] = "Retic %";
replaceArray["ABSOLUTE RETIC COUNT"] = "Abs Retic #";
replaceArray["RETICULOCYTE HGB"] = "Retic Hgb";
replaceArray["IMMATURE RETIC FRACTION"] = "Imm Retic Frxn";
replaceArray["IMMATURE PLT FRACTION"] = "Imm plt";
replaceArray["NUCLEATED RBC/100WBC"] = "NRBC/100WBC";
replaceArray["NUCLEATED RED CELLS"] = "NRBC/100WBC";
replaceArray["ALPHA-1 FRACTION"] = "A1 Globulin";
replaceArray["ALPHA-2 FRACTION"] = "A2 Globulin";
replaceArray["BETA FRACTION"] = "B Globulin";
replaceArray["GAMMA FRACTION"] = "G Globulin";
replaceArray["GAMMA GLOBULIN"] = "G Globulin";

replaceArray["ALPHA1 GLOBULIN(EP)(b)"] = "A1 Globulin";
replaceArray["ALPHA2 GLOBULIN(EP)(b)"] = "A2 Globulin";
replaceArray["BETA GLOBULIN(EP)(b)"] = "B Globulin";
replaceArray["GAMMA GLOBULIN(EP)(b)"] = "G Globulin";
replaceArray["A/G RATIO(EP)(b)"] = "A/G Ratio";
replaceArray["PROTEIN,TOTAL(EP)(b)"] = "Protein";
replaceArray["ALBUMIN(EP)(b)"] = "Albumin";
replaceArray["PROTEIN, SERUM TOTAL (B)"] = "Protein";
replaceArray["A/G RATIO,SERUM (DC'd)"] = "A/G Ratio";
replaceArray["IgA,Serum"] = "IgA";
replaceArray["PFA COLLAGEN/EPI"] = "PFA Collagen/Epi";
replaceArray["PFA COLLAGEN/ADP"] = "PFA Collagen/ADP";
replaceArray["JAK2 MUTATION"] = "JAK2 Mutation";
replaceArray["BCR-ABL1/ABL1%"] = "BCR-ABL1 %";
replaceArray["BCR-ABL1/ABL1% (IS)"] = "BCR-ABL1 % (IS)";
replaceArray["P190 BCR-ABL1"] = "P190 BCR-ABL1";
replaceArray["P210 BCR-ABL1"] = "P210 BCR-ABL1";
replaceArray["FLOW CYTOMETRY-YALE"] = "Flow Cytometry (Yale)";
replaceArray["CD3+ %"] = "CD3+ %";
replaceArray["CD3+ #"] = "CD3+ #";
replaceArray["CD3+,CD4+ %"] = "CD3+,CD4+ %";
replaceArray["CD3+,CD4+ #"] = "CD3+,CD4+ #";
replaceArray["CD3+,CD8+ %"] = "CD3+,CD8+ %";
replaceArray["CD3+,CD8+ #"] = "CD3+,CD8+ #";
replaceArray["CD4/CD8 RATIO"] = "CD4/CD8 Ratio";
replaceArray["CD19+ %"] = "CD19+ %";
replaceArray["CD19+ #"] = "CD19+ #";
replaceArray["CD56+/CD16+//CD3- %"] = "CD56+/CD16+/CD3- %";
replaceArray["CD56+/CD16+//CD3- #"] = "CD56+/CD16+/CD3- #";

replaceArray["THROMBIN TIME"] = "Thrombin Time";
replaceArray["dRVVT MIX INTERPRET"] = "dRVVT interpret";
replaceArray["PTT-LA SCREEN"] = "PTT-LA";
replaceArray["HEXAGONAL PHASE CONFIRMATION"] = "Hexagonal phase confirm";
replaceArray["DRVVT SCREEN"] = "dRVVT Screen";
replaceArray["DRVVT CONFIRM"] = "dRVVT Confirm";

replaceArray["INTERLEUKIN-2 RECEPTOR"] = "IL-2 Receptor";
replaceArray["PT(YALE)"] = "PT";
replaceArray["PTT (YALE)"] = "PTT";
replaceArray["FACTOR VII ACT"] = "Factor VII Act";
replaceArray["FACTOR IX ACT,YALE"] = "Factor IX Act";
replaceArray["FACTOR II ACT"] = "Factor II Act";
replaceArray["FACTOR X ACT"] = "Factor X Act";

replaceArray["PROTHROMBIN MUTATION"] = "Prothrombin Mutation";
replaceArray["FACTOR V LEIDEN"] = "Factor V Leiden";
replaceArray["PROTEIN C ANTIGEN"] = "Protein C Ag";
replaceArray["PROTEIN S ANTIGEN"] = "Protein S Ag";
replaceArray["PROTEIN S ACTIVITY"] = "Protein S Activity";
replaceArray["PROTEIN C ACTIVITY"] = "Protein C Activity";
replaceArray["ABSOLUTE GRANULOCYTES"] = "ABSOLUTE NEUTROPHIL COUNT";
replaceArray["ABSOLUTE LYMPHOCYTES"] = "ABSOLUTE LYMPHOCYTE COUNT";
replaceArray["ABSOLUTE EOS."] = "AEC";
replaceArray["ABSOLUTE BASOPHILS"] = "ABC";
replaceArray["ABSOLUTE MONOCYTES"] = "AMC";
replaceArray["ABSOLUTE IG"] = "AIG";
replaceArray["ABSOLUTE NRBC"] = "ANRBC";
replaceArray["EOS %"] = "Eos";
replaceArray["IG %"] = "Bands";
replaceArray["ESR(NEW)"] = "ESR";
replaceArray["CRP(INFLAMMATORY)"] = "CRP";
replaceArray["esr(dc'd 3/17)"] = "ESR";
replaceArray["CREATINE KINASE"] = "CK";

//Coags
replaceArray["FIBRINOGEN"] = "Fibrinogen";
replaceArray["PT"] = "PT";
replaceArray["pt"] = "PT";
replaceArray["PTT"] = "PTT";
replaceArray["INR"] = "INR";
replaceArray["CLINIC INR (POC)"] = "INR POC";
replaceArray["ANTI-Xa LMW HEPARIN"] = "Anti-Xa LMWH";
replaceArray["ANTI-Xa UF HEPARIN"] = "Anti-Xa UFH";

//Nutritional
replaceArray["COPPER,SERUM"] = "Copper";
replaceArray["ZINC,PLASMA"] = "Zinc";
replaceArray["ALUMINUM,PLASMA"] = "Aluminum";
replaceArray["CAROTENE"] = "Carotene";
replaceArray["VITAMIN B1"] = "Vit B1";
replaceArray["HOMOCYSTEINE,SERUM"] = "Homocysteine";
replaceArray["CHOLESTEROL"] = "CHOL";
replaceArray["TRIGLYCERIDE"] = "TG";
replaceArray["HDL"] = "HDL";
replaceArray["HDL CHOLESTEROL"] = "HDL";
replaceArray["LDL"] = "LDL";
replaceArray["LDL CHOLESTEROL (CALC)"] = "LDL";
replaceArray["LDL,DIRECT"] = "LDL Direct";
replaceArray["ZLIPOPROTEIN(A)pre 3-29-06"] = "Lipoprotein(A)";
replaceArray["VITAMIN B-6"] = "Vit B6";

//Rheum
replaceArray["ANGIOTENSIN CONV ENZ,SERUM"] = "ACE";
replaceArray["RHEUMATOID FACTOR"] = "RF";
replaceArray["RHEUMATOID FACTOR (B)"] = "RF";
replaceArray["CRYGLOBULIN,SERUM"] = "Cryoglobulin";
replaceArray["WEST. SED RATE"] = "ESR";
replaceArray["CRP,INFLAMMATION"] = "CRP";
replaceArray["CRPinfl"] = "CRP";
replaceArray["CRP,CARDIAC RISK"] = "Cardiac CRP";
replaceArray["ANA TITER"] = "ANA Titer";
replaceArray["ANA SCREEN (B)"] = "ANA";
replaceArray["ANTI-SCL-70"] = "Anti-SCL-70";
replaceArray["ANCA IFA SCREEN"] = "ANCA IFA Screen";
replaceArray["ANGIOTENSIN CONV ENZ,CSF"] = "ACE";
replaceArray["ESR(Manual/Westergren)"] = "ESR";
replaceArray["CENTROMERE"] = "Centromere";
replaceArray["PERIPHERAL"] = "Peripheral";
replaceArray["SPECKLED"] = "Speckled";
replaceArray["HOMOGENOUS"] = "Homogeneous";
replaceArray["HOMOGENEOUS"] = "Homogeneous";
replaceArray["NUCLEOLAR"] = "Nucleolar";
replaceArray["ANTI-JO-1"] = "Anti-Jo-1";
replaceArray["ANTI-SCL-70"] = "Anti-Scl-70";
replaceArray["ANTI-dsDNA"] = "Anti-dsDNA";
replaceArray["ANTI-SM/RNP"] = "Anti-Sm/RNP";
replaceArray["ANTI-CHROMATIN"] = "Anti-Chromatin";
replaceArray["PL-7 AUTO ABS"] =  "Anti-PL-7";
replaceArray["PL-12 AUTO ABS"] = "Anti-PL-12";
replaceArray["MI-2 AUTO ABS"] = "Anti-Mi-2";
replaceArray["KU AUTO ABS"] = "Anti-Ku";
replaceArray["EJ AUTO ABS"] = "Anti-EJ";
replaceArray["OJ AUTO ABS"] = "Anti-OJ";
replaceArray["SRP AUTO ABS"] = "Anti-SRP";
replaceArray["JO-1 AUTO ABS"] = "Anti-Jo-1";
replaceArray["ANTI-SM"] = "Anti-Sm";
replaceArray["ANTI-RNP"] = "Anti-RNP";
replaceArray["ANTI-SSA"] = "Anti-SSA";
replaceArray["ANTI-SSB"] = "Anti-SSB";
replaceArray["ANTI DNA,DOUBLE-STRANDED"] = "Anti-dsDNA";
replaceArray["ANA INTERPRETATION"] = "ANA interp";
replaceArray["ANA TEST REMARKS"] = "ANA test remark";
replaceArray["antiCCP"] = "Anti-CCP";
replaceArray["HU,YO,RI AB'S W/ RFLX"] = "Anti-Hu,Yo,Ri";
replaceArray["RIBOSOMAL P AB"] = "Anti-Ribosomal P";
replaceArray["ANTI-HISTONE ANTIBODIES"] = "Anti-Histone";
replaceArray["ANTI-PROTEINASE-3 ANTIBODY"] = "Anti-PR3";
replaceArray["ANTI-MYELOPEROXIDASE"] = "Anti-MPO";

//Micro
replaceArray["MRSA SURVL NARES AGAR"] = "MRSA DNA";
replaceArray["MRSA SURVL NARES DNA"] = "MRSA DNA";
replaceArray["HSV IGM AB SCREEN"] = "HSV IgM Screen";
replaceArray["HSV IGM AB TITER"] = "HSV IgM Titer";
replaceArray["RUBELLA AB"] = "Rubella Ab";
replaceArray["MUMPS AB SCREEN"] = "Mumps Ab Screen";
replaceArray["MEASLES-RUBEOLA Ab"] = "Measles Ab";
replaceArray["VARICELLA ZOSTER(VZ) IGG"] = "VZV IgG";
replaceArray["MONO TEST"] = "Mono Test";
replaceArray["VIRAL CAPSID IgG ANTIBODY"] = "EBV Capsid IgG";
replaceArray["VIRAL CAPSID IgM ANTIBODY"] = "EBV Capsid IgM";
replaceArray["ENBA"] = "EBV Nuc Ag";
replaceArray["WNV IGG,CSF"] = "WNV IgG CSF";
replaceArray["WNV IGM,CSSF"] = "WNV IgM CSF";
replaceArray["ENTEROVIRUS RNA, PCR"] = "Enterovirus PCR";
replaceArray["PARECHOVIRUS RNA, PCR"] = "Parechovirus PCR";
replaceArray["LYME IGG AB,CSF"] = "Lyme IgG CSF";
replaceArray["LYME IGM AB,CSF"] = "Lyme IgM CSF";
replaceArray["Zvdrl (D/C)"] = "VDRL";
replaceArray["GONORRHOEAE PCR"] = "Gonorrhea PCR";
replaceArray["M.PNEUMONIAE AB IGG"] = "M. pneumoniae IgG";
replaceArray["M.PNEUMONIAE AB IGM"] = "M. pneumoniae IgM";
replaceArray["HIV AB/ P24 AG COMBO"] = "HIV Ab/Ag Screen";
replaceArray["HIV-RNA,DETECTION"] = "HIV PCR Screen";
replaceArray["HIV-RNA,COPIES"] = "HIV Qnt";
replaceArray["HIV-RNA,LOG 10"] = "HIV Log10";
replaceArray["HIV-RNA PCR(DC'D 7-31-08)"] = "HIV PCR";
replaceArray["HEPATITIS A AB IGG"] = "Hep A IgG";
replaceArray["HEPATITIS A AB IGM"] = "Hep A IgM";
replaceArray["HAV TOT"] = "Hep A IgG/IgM";
replaceArray["HEP B SURF AG"] = "Hep B Surf Ag";
replaceArray["HEP B SURF AB"] = "Hep B Surf Ab";
replaceArray["HEP B CORE AB IgM"] = "Hep B Core IgM";
replaceArray["HEP B CORE,TOTAL"]= "Hep B Core, Total";
replaceArray["ZZHCV-PCR"] = "HCV PCR";
replaceArray["HCV-RNA,QNT"] = "HCV Qnt";
replaceArray["HCV-RNA,QNT(Log10)"] = "HCV Log10";
replaceArray["HCV-RNA,DETECTION"] = "HCV PCR Screen";
replaceArray["HEPATITIS C Ab"] = "HCV Ab";
replaceArray["HCVQNT"] = "HCV Qnt";
replaceArray["HIV GENOTYPE(DC'd 1-12-06)"] = "HCV Genotype";
replaceArray["HPSAG"] = "H. Pylori Ag";
replaceArray["TOXOPLASMA AB IGG"] = "Toxo IgG";
replaceArray["TOXOPLASMA AB IGM"] = "Toxo IgM";
replaceArray["Rpr (Syphilis)"] = "RPR";
replaceArray["BABESIA SMEAR"] = "Babesia smear";
replaceArray["EHRLICHIA SMEAR"] = "Ehrlichia smear";
replaceArray["LYME AB,SERUM"] = "Lyme ELISA";
replaceArray["LYME WEST. BLOT IGG"] = "Lyme IgG (Western)";
replaceArray["LYME WEST. BLOT IGM"] = "Lyme IgM (Western)";
replaceArray["LEGIONELLA ANTIGEN,URINE"] = "Legionella Ag";
replaceArray["CMV AB SCREEN(pre 8-17-04)"] = "CMV AB Screen";
replaceArray["CHLAMYDIA PCR"] = "Chlamydia PCR";
replaceArray["GONORRHOEAE PCR(COBAS COLLECTION KIT)"] = "Gonorrhoeae PCR";
replaceArray["N.GON"] = "Gonorrhoeae PCR";
replaceArray["QUANTIFERON-TB GOLD"] = "TB Quant Gold";
replaceArray["QF-NIL"] = "Quant Nil";
replaceArray["QF-MITOGEN-NIL"] = "Quant Mitogen Nil";
replaceArray["QF-TB-NIL"] = "Quant TB Nil";
replaceArray["QUANTIFERON(DC'D 4/22/14)"] = "TB Quant Gold";
replaceArray["RESPIRATORY SCREEN"] = "Resp Screen";
replaceArray["HCV GENOTYPE"] = "HCV Genotype";
replaceArray["CMV TITER(pre 8-17-04)"] = "CMV titer";
replaceArray["VDRL,CSF (WROX)"] = "VDRL";
replaceArray["CMV DNA,QUAL,PCR(CSF)"] = "CMV PCR";
replaceArray["EBV DNA,QN"] = "EBV PCR";
replaceArray["CRYPTOCOCCUS AG"] = "Crypto Ag";
replaceArray["HBV-DNA,DETECTION"] = "HBV DNA";
replaceArray["SYPHILIS ABs W/REFLEX"] = "Syphilis AB";
replaceArray["S.PNEUMO AG,URINE"] = "S. pneumo Ag";
replaceArray["C DIFF TOX B GENE PCR"] = "C Diff Tox B PCR";
replaceArray["LYME AB,SERUM(DC'D 9/27/16)"] ="Lyme Ab";
replaceArray["HEPATITIS Be Ag"] = "Hep B Ag";
replaceArray["HEPATITIS Be Ab"] = "Hep B Ab";
replaceArray["GIARDIA AG"] = "Giardia Ag";
replaceArray["CRYPTOSPORIDIUM AG"] = "Cryptosporidium Ag";
replaceArray["HBV B DNA,COPIES"] = "HBV DNA Copies";
replaceArray["HBV B DNA,UNITS"] = "HBV DNA Log";
replaceArray["COCCIDIOIDES CF,SERUM"] = "Coccidioides CF";
replaceArray["HISTOPLASMA AG"] = "Histoplasma Ag";
replaceArray["HISTOPLAS,SPECIMEN"] = "Histo Specimen";
replaceArray["HISTOPLASMA,INTERP"] = "Histo Interp";
replaceArray["ANAPLASMA PCR"] = "Anaplasma PCR";
replaceArray["ANAPLASMA SMEAR"] = "Anaplasma Smear";
replaceArray["B.HENSELAE IGG SCR"] = "B.Henselae IgG";
replaceArray["B.HENSELAE IGM SCR"] = "B.Henselae IgM";
replaceArray["Q-FEVER IGG PH1 SCR"] = "Q-Fever IgG Ph1";
replaceArray["Q-FEVER IGM PH1 SCR"] = "Q-Fever IgM Ph1";
replaceArray["Q-FEVER IGG PH2 SCR"] = "Q-Fever IgG Ph2";
replaceArray["Q-FEVER IGM PH2 SCR"] = "Q-Fever IgM Ph2";
replaceArray["BRUCELLA IGG"] = "Brucella IgG";
replaceArray["BRUCELLA IGM"] = "Brucella IgM";
replaceArray["HISTOPLASMA AB (ID)"] = "Histoplasma Ab";

//Drug/Tox Levels
replaceArray["VANCOMYCIN,PEAK"] = "Vancomycin, peak";
replaceArray["PHENYTOIN"] = "Phenytoin";
replaceArray["CARBAMAZEPINE"] = "Carbamazepine";
replaceArray["VALPROIC ACID"] = "Valproic acid";
replaceArray["VANCOMYCIN,TROUGH"] = "Vanc trough";
replaceArray["VANCOMYCIN (TROUGH)"]  = "Vanc trough";
replaceArray["TRICYCLIC SCREEN"] = "TCA Screen";
replaceArray["TRICYCL"] = "TCA Screen";
replaceArray["ETHANOL"] = "ETOH";
replaceArray["ACETAMINOPHEN"] = "Acetaminophen";
replaceArray["SALICYLATE"] = "Salicylate";
replaceArray["CYCLOSPORINE"] = "Cyclosporine";
replaceArray["MARIJUANA,SERUM"] = "Marijuana";
replaceArray["AMPHETAMINE,SERUM"] = "Amphetamine";

replaceArray["AMPHETAMINE SCRN"] = "AMPHETAMINES SCREEN";
replaceArray["BENZODIAZEPINES SCREEN"] = "BENZODIAZEPI SCREEN";
replaceArray["CANNABINOID SCRN"] = "CANNABINOIDS SCREEN";


replaceArray["BARBITURATE,SERUM"] = "Barbiturate";
replaceArray["BDZ,SERUM"] = "BZD";
replaceArray["COCAINE,SERUM"] = "Cocaine";
replaceArray["PHENCYCLIDINE,SERUM"] = "PCP";
replaceArray["OPIATES,SERUM"] = "Opiates";
replaceArray["METHADONE,SERUM"] = "Methadone";
replaceArray["PROPOXYPHENE,SERUM"] = "Propoxyphene";
replaceArray["DIGOXIN"] = "Digoxin";
replaceArray["GENTAMICIN"] = "Gentamicin";
replaceArray["FK506-RENAL-QUEST"] = "Tacrolimus";
replaceArray["LAMOTRIGINE"] = "Lamotrigine";
replaceArray["LITHIUM"] = "Lithium";
replaceArray["VANCOMYCIN,RANDOM"] = "Vancomycin (random)";
replaceArray["METHANOL(YALE)"] = "Methanol";
replaceArray["ACETONE(YALE)"] = "Acetone";
replaceArray["ETHANOL(YALE)"] = "Ethanol";
replaceArray["ISOPROPANOL(YALE)"] = "Isopropanol";
replaceArray["ETHYLENE GLYCOL"] = "Ethylene glycol";
replaceArray["PROPYLENE GLYCOL"] = "Propylene glycol";
replaceArray["FENT,SCREEN"] = "Fent screen";
replaceArray["ETHYL GLUCURONIDE SCRN"] = "Ethyl Glucuronide";
replaceArray["ETHYL GLUCURONIDE(wrj)"] = "Ethyl Glucuronide";
replaceArray["LEVETIRACETAM"] = "Keppra";
replaceArray["SPECIFIC GRAVITY DAU"] = "SPECIFIC GRAVITY"

//SMEAR
replaceArray["PLT (ESTM)"] = "PLT (Estm)";
replaceArray["ANISOCYTOSIS"] = "Anisocytosis";
replaceArray["POIKILOCYTOSIS"] = "Poikilocytosis";
replaceArray["OVALOCYTES"] = "Ovalocytes";
replaceArray["ACANTHOCYTES"] = "Acanthocytes";
replaceArray["TEARDROPS"] = "Teardrops";
replaceArray["TARGET CELLS"] = "Target cells";
replaceArray["POLYCHROMASIA"] = "Polychromasia";
replaceArray["HYPOCHROMIA"] = "Hypochromia";
replaceArray["NORMOCHROMIC"] = "Normochromic";
replaceArray["BASOPHILIC STIPPLING"] = "Basophilic stippling";
replaceArray["TOXIC GRANULATION"] = "Toxic granulation";
replaceArray["SCHISTOCYTES"] = "Schistocytes";
replaceArray["SPHEROCYTES"] = "Spherocytes";
replaceArray["STOMATOCYTES"] = "Stomatocytes";
replaceArray["MICROCYTOSIS"] = "Microcytosis";
replaceArray["MACROCYTOSIS"] = "Macrocytosis";
replaceArray["NORMOCYTIC"] = "Normocytic";
replaceArray["ATYPICAL LYMPHS"] = "Atypical Lymphs";
replaceArray["METAMYELOCYTES"] = "Metamyelocytes";
replaceArray["MYELOCYTES"] = "Myelocytes";
replaceArray["PROMYELOCYTES"] = "Promyelocytes";
replaceArray["BLASTS"] = "Blasts";

replaceArray["NEUT %"] = "PMN";
replaceArray["SEGS"] = "PMN";
replaceArray["LYMPH %"] = "Lymph";
replaceArray["LYMPHS"] = "Lymph";
replaceArray["MONO %"] = "Mono";
replaceArray["MONOS"] = "Mono";
replaceArray["EOSIN %"] = "Eos";
replaceArray["EOSINOPHILS"] = "Eos";
replaceArray["BASO %"] = "Baso";
replaceArray["BASOPHILS"] = "Baso";
replaceArray["IMMATURE GRAN %"] = "Bands";
replaceArray["BANDS"] = "Bands";
replaceArray["OTHER"] = "Other"
replaceArray["SMUDGE CELLS"] = "Smudge cells"
replaceArray["ATYPICAL MONOCYTES"] = "Atypical Monocytes";
var smearList = ["PLT (Estm)","Anisocytosis","Poikilocytosis","Ovalocytes","Acanthocytes","Teardrops","Target cells","Smudge cells","Polychromasia","Hypochromia","Normochromic","Basophilic stippling","Toxic granulation","Schistocytes","Spherocytes","Stomatocytes","Microcytosis","Macrocytosis","Normocytic","Atypical Lymphs","Atypical Monocytes","Metamyelocytes","Myelocytes","Promyelocytes","Blasts","Other"];

//Other
replaceArray["OCCULT BLOOD(X1)(WARD)"] = "FOBTx1";
replaceArray["GLUCOSE,RANDOM"] = "Glucose";
replaceArray["APPEARANCE"] = "Appearance";
replaceArray["PH,FLUID"] = "pH";
replaceArray["PROTEIN,TOTAL"]="Protein";
replaceArray["COLOR"] = "Color";
replaceArray["NUCLEATED CELLS"] = "Nucleated cells";
replaceArray["MACROPHAGES"] = "Macrophages";
replaceArray["MESOTHELIAL CELLS"] = "Mesothelial cells";
replaceArray["OCCULT BLOOD #1"] = "FOBT #1";
replaceArray["OCCULT BLOOD #2"] = "FOBT #2";
replaceArray["OCCULT BLOOD #3"] = "FOBT #3";
replaceArray["TISSUE CELLS"] = "Tissue Cells";
replaceArray["PROTEIN,CSF"] = "CSF Protein";
replaceArray["WBC-BODY FLUID (WBC-BF)"] = "WBC";
replaceArray["RBC-BODY FLUID (RBC-BF)"] = "RBC";
replaceArray["MONONUCLEATED CELLS(MN)"] = "MN";
replaceArray["PMN-BF"] = "PMN";
replaceArray["TNC-BF"] = "Nucleated cells";
replaceArray["FECAL WBC'S (DC'D 9-28-11)"] = "Fecal WBC";
replaceArray["FAT,STOOL(QUAL)"] = "Fecal fat";
replaceArray["CSF OLIGOCLONAL BANDS"] = "Oligoclonal bands";
replaceArray["SERUM ALBUMIN"] = "Serum Albumin";
replaceArray["CSF ALBUMIN"] = "CSF Albumin";
replaceArray["SERUM IgG"] = "Serum IgG";
replaceArray["ACHRbin"] = "AChR Binding Ab";
replaceArray["PLAVIX RESISTANCE TEST"] = "Plavix Resistance";
replaceArray["MARKERS ASSAYED"] = "Markers Assayed";
replaceArray["GATE CORRECTED"] = "Gate Corrected";
replaceArray["OTHER CELLS"] = "Other cells";
replaceArray["ALPHA-1-ANTITRYPSIN,FECES"] = "A1-Antitrypsin";
replaceArray["NOROVIRUS PCR (YALE)"] = "Norovirus PCR";
replaceArray["FENTANYL SCREEN,URINE"] = "FENTANYL SCREEN";
replaceArray["FENTANYL"] = "FENTANYL SCREEN";
//Blood gas:
replaceArray["pH(POC)"] = "PH";
replaceArray["pCO2(POC)"] = "PCO2";
replaceArray["pO2(POC)"] = "PO2";
replaceArray["BICARBONATE"] = "HCO3";
replaceArray["HCO3(POC)"] = "HCO3";
replaceArray["HGB(POC)"] = "HGB POC";
replaceArray["Na(POC)"] = "Na POC";
replaceArray["K(POC)"] = "K POC";
replaceArray["Ca++(POC)"] = "Ca++ POC";
replaceArray["BASE EXCESS(POC)"] = "Base Excess POC";
replaceArray["CL(POC)"] = "CHLORIDE";
replaceArray["CREATININE(POC)"] = "CREATININE,SERUM";
replaceArray["BUN(POC)"] = "UREA NITROGEN";
replaceArray["GLUCOSE(ISTAT POC)"] = "Glucose";
replaceArray["ANION GAP(POC)"] = "ANION GAP";

function fs() 
{
	if(typeof String.prototype.trim !== 'function') {
		String.prototype.trim = function() {
			return this.replace(/^\s+|\s+$/g, ''); 
		}
	}
    var str1 = document.getElementById('clipb').value;
    document.getElementById('edtData').innerText = "";
    vals = str1.split("\n");
    listVals = {};
    listCrit = {};
    listUH = {};
    listPH = {};
    listTime = {};
    listSpecimen = {};
    listMicro = new Array();
    listMicroSpec = new Array();
    medList = new Array();
	
	var curTime = "";
    var curSpec = "";
    var resultTime = "";
	var curComment = "";
	medListOutpatient = false;
	for (i = 0; i < vals.length; i++) 
	{
		var labCode = / \[([0-9]{3,4})\]/;
		var includeList = false;
		var vvv = labCode.exec(vals[i].replace("].","."));
		if(vvv != null)
			includeList = true;
		if(!includeList && timeToDate(curTime) < Date.now() - msDay*10*365)
		{
			for(var p in replaceArray)
			{
				if(vals[i].substr(0,p.length) == p)
					includeList = true;
			}
		}
		if(includeList && vals[i].indexOf("Test Not Performed") != -1)
			includeList = false;
		var numCode = /([0-9]{1,2})\)/;
		if(numCode.exec(vals[i].substr(0,3)) != null)
		{
			includeList = false;
			if(vals[i].indexOf("  ACTIVE") != -1 || vals[i].indexOf("  ACTIVE (S)") != -1 || vals[i].indexOf("  PENDING") != -1)
			{
				medListOutpatient = true;			
			}
			var mL = vals[i].substr(3).replace(" ACTIVE (S)","").replace(" ACTIVE","").replace(" PENDING","").replace("Non-VA ","").trim() + " ";
			i++;
			while(i < vals.length && (numCode.exec(vals[i].substr(0,3)) == null))
			{
				if(vals[i].indexOf("Active Non-VA Medications                              Status") == -1 && vals[i].indexOf("=========================================================================") == -1)
				{
					mL += vals[i].trim().replace("Non-VA ","") + " ";
				}
				i++;
			}
			i--;
			medList.push(mL);
		}
        if (includeList) 
		{
            	var temp = vals[i];
			var tj = i;
			while(vals[tj].substr(0,10) == "          " && tj > 0)
			{
				tj--;
			}
			temp = "";
			while(tj <= i)
			{
				temp += vals[tj];
				tj ++;
			}
		    if(temp.indexOf("HELICOBACTOR PYLORI AG,STOOL") != -1)
				temp = temp.replace("HELICOBACTOR PYLORI AG,STOOL","HPSAG    ");
			if(temp.indexOf("HCV PCR (QNT-HI) pre10-24-06") != -1)
				temp = temp.replace("HCV PCR (QNT-HI) pre10-24-06","HCV Qnt    ");
			if(temp.indexOf("HCV RNA RT-PCR(DC'D 3-2-09)") != -1)
				temp = temp.replace("HCV RNA RT-PCR(DC'D 3-2-09)","HCV Qnt    ");
			if(temp.indexOf("HERPES PCR CSF(DC'D 5/14/15)") != -1)
				temp  = temp.replace("HERPES PCR CSF(DC'D 5/14/15)","HSV CSF PCR    ");
			if(temp.indexOf("OCCULT BLOOD(FIT) #1 OF 1") != -1)
				temp = temp.replace("OCCULT BLOOD(FIT) #1 OF 1", "FIT #1 of 1    ");
			if(temp.indexOf("Rpr (Syphilis)(DC'D 6-16-17)") != -1)
				temp = temp.replace("Rpr (Syphilis)(DC'D 6-16-17)", "RPR    ");
			if(temp.indexOf("LYME AB,SERUM(DC'D 9/27/16)") != -1)
				temp = temp.replace("LYME AB,SERUM(DC'D 9/27/16)", "Lyme Ab    ");
			if(temp.indexOf("HEXAGONAL PHASE CONFIRMATION") != -1)
				temp = temp.replace("HEXAGONAL PHASE CONFIRMATION", "Hexagonal phase confirm    ");
            var lab = myTrim(temp.substring(0, temp.indexOf("  ")));
            var valsearch = /\S[.A-Za-z0-9,_+:\//\-=]*/;
		    var val = valsearch.exec(temp.substring(temp.indexOf("  ")));
		    if(val == "<")
		    {
				var tempVal = temp.replace("<"," ");
				val = "< " + valsearch.exec(tempVal.substring(temp.indexOf("  ")));
	        } else if(val == ">")
		    {
				var tempVal = temp.replace(">"," ");
				val = "> " + valsearch.exec(tempVal.substring(temp.indexOf("  ")));
		    } else if(val == "Not" || val == "NOT")
			{
				var tempVal = temp.replace("Not "," ").replace("NOT "," ");
				val = "Not " + valsearch.exec(tempVal.substring(temp.indexOf("  ")));				
			}else if(val == "SEE" || val == "See")
			{
				var tempVal = temp.replace("SEE "," ").replace("See "," ");
				val = "SEE " + valsearch.exec(tempVal.substring(temp.indexOf("  ")));				
			} else if(val == "Non" || val == "NON")
			{
				var tempVal = temp.replace("Non "," ").replace("NON "," ");
				val = "Non " + valsearch.exec(tempVal.substring(temp.indexOf("  ")));				
			} else if(val == "OCCASIONAL" || val == "Occasional")
			{
				var tempVal = temp.replace("OCCASIONAL "," ").replace("Occasional "," ");
				val = "Occasional " + valsearch.exec(tempVal.substring(temp.indexOf("  ")));				
			} else if(val == "SLIGHT" || val == "Slight")
			{
				var tempVal = temp.replace("SLIGHT "," ").replace("Slight "," ");
				val = "Slight " + valsearch.exec(tempVal.substring(temp.indexOf("  ")));				
			} 
			if(val == "NEGATIVE" || val == "NEG" || val == "NON-REACTIVE" || val == "negative" || val == "Non Reactive" || val == "Not Reactive" || val == "nonreactive" || val == "Nonreactive" || val == "Not DETECTED")
			{
				val = "Neg";
			} else if (val == "POSITIVE" || val == "POS" || val == "REACTIVE" || val == "Reactive" || val == "DETECTED")
			{
				val = "Pos";
			} else if (val == "BORDERLINE")
			{
				val = "Borderline";
			} else if (val == "ADEQUATE" || val == "Adeq.")
			{
				val = "Adeq";
			} else if (val == "YES")
			{
				val = "Yes";
			} else if (val == "NO")
			{
				val = "No";
			} else if (val == "REDUCED")
			{
				val = "Low";
			}
		    if(temp.indexOf("  ") == 0)
		    {
				lab = myTrim(temp.substring(0, temp.indexOf("   ")));
				val = valsearch.exec(temp.substring(temp.indexOf("   ")));
            }
            val = ("" + val + "").replace(/\</g,"&#060;").replace(/\>/g,"&#062;");

		    if(val == "[none")
				val = "none";
			if(val == "NONREPORTABLE")
				val = "***";
			
			if(lab in replaceArray)
				lab = replaceArray[lab];
		  if(lab == "Centromere" || lab == "Peripheral" || lab == "Speckled" || lab == "Homogeneous" || lab == "Nucleolar")
		  {
			if(i != 0 && vals[i-1].indexOf("ANA TITER") != -1)
			{
				var tv = val;
				val = lab;
				lab = "ANA Pattern";
				if("ANA Titer" in listVals)
				{
					var ind = listVals["ANA Titer"].length - 1;
					if(listTime["ANA Titer"][ind] == curTime)
					{
						listVals["ANA Titer"][ind] = tv;
						if(tv.indexOf(":") != -1 && parseInt(tv.split(":")[1]) > 40)
						{
							listCrit["ANA Titer"][ind] = "H";
							listUH["ANA Titer"][ind] = tv + " H";
						} else
						{
							listCrit["ANA Titer"][ind] = "N";
							listUH["ANA Titer"][ind] = tv;
						}
					}
				}
			} else if(i !=0 && vals[i-1].indexOf("ANA") != -1)
			{
		  if(!("ANA Titer"  in listVals))
		  {
				listVals["ANA Titer"] = new Array();
				listCrit["ANA Titer"] = new Array();			
				listUH["ANA Titer"] = new Array();
				listPH["ANA Titer"] = new Array();
				listTime["ANA Titer"] = new Array();
				listSpecimen["ANA Titer"] = new Array();
				listComment["ANA Titer"] = new Array();
		    }
		    var tv = val;
				    val = lab;
		    lab = "ANA Pattern";
		    listVals["ANA Titer"].push(tv);
		    var crit = "N";
				    if(tv.indexOf(":") != -1 && parseInt(tv.split(":")[1]) > 40)
				    {
					   crit = "H";
		    } 
	    var uh = val;
	    if(crit != "N")
		    uh += " " + crit;
	    listCrit["ANA Titer"].push(crit);
	    listUH["ANA Titer"].push(uh);
	    var ph = val + "%";
	    if(crit != "N")
		   ph += " " + crit;   
	    listPH["ANA Titer"].push(ph); 
         listTime["ANA Titer"].push(curTime);
		    		    listSpecimen["ANA Titer"].push(curSpec);
	    listComment["ANA Titer"].push(curComment);
			}
		  }
		  if(!(lab in listVals))
		  {
				listVals[lab] = new Array();
				listCrit[lab] = new Array();			
				listUH[lab] = new Array();
				listPH[lab] = new Array();
				listTime[lab] = new Array();
				listSpecimen[lab] = new Array();
				listComment[lab] = new Array();
		    }
            listVals[lab].push(val);
		    var crit = "N";
            if (temp.indexOf(val + " H") != -1)
                crit = "H";
            if (temp.indexOf(val + " L") != -1)
                crit = "L";
            var uh = val;
		    if(crit != "N")
				uh += " " + crit;
			if(val == "Pos")
				crit = "H";
		    listCrit[lab].push(crit);
	        listUH[lab].push(uh);
		    var ph = val + "%";
		    if(crit != "N")
			ph += " " + crit;   
		    listPH[lab].push(ph);
		    listTime[lab].push(curTime);
			
			if(curSpec.indexOf("MIXED VENOUS") != -1)
				curSpec = "MIXED VENOUS BLOOD";
			
		    listSpecimen[lab].push(curSpec);
			listComment[lab].push(curComment);
			if(lab == "Calcium")
				templateSpecial("Corrected Calcium","Calcium");
			if(lab == "Retic %")
				templateSpecial("Retic Index","Retic %");
			if(lab == "Osmolality" && curSpec == "SERUM")
				templateSpecial("Osm Gap","Osmolality");	
			} else if (vals[i].indexOf("====================================") != -1 && listMicro.length > 0) 
			{
				var tlm = listMicro.pop();
				var ts = tlm.split("\n");
				if(ts[ts.length - 1] != "")
				{
					listMicro.push(tlm + "\n");
				} else
				{
					listMicro.push(tlm);
				}
						
			} else if (vals[i].indexOf("Specimen:") != -1) 
			{
				curSpec = vals[i].split(": ")[1].split(". ")[0].trim();
				var newI = i +1;
				curComment = "";
				var gettingComment = false;
				while(newI < vals.length && vals[newI].indexOf("===============================") == -1)
				{
					if(gettingComment)
						curComment += " " + vals[newI].trim() + "NEWLINECOMMENT";
					if(vals[newI].substr(0,8)=="Comment:")
					{
						curComment += vals[newI].split("Comment:")[1] + "NEWLINECOMMENT";
						gettingComment = true;
					}
					newI++;
				}
				curComment = curComment.replace(/\</g,"&#060;").replace(/\>/g,"&#062;").replace(/@/g," at ");
			} else if (vals[i].indexOf("Specimen Collection Date:") != -1) 
			{
				curTime = vals[i].replace("Specimen Collection Date:", "").trim();
				if(curTime.indexOf("@") == -1)
				{
					if(resultTime.indexOf("@") != -1 && resultTime.split("@")[0] == curTime)
					{
						curTime = resultTime;
					} else if(resultTime.indexOf("@") != -1)
					{
						curTime += "@" + resultTime.split("@")[1];
					} else
					{
						curTime += "@00:00";
					}
				}
			} else if(vals[i].indexOf("Report Released Date/Time:") != -1) {
				resultTime = vals[i].replace("Report Released Date/Time:", "").trim();
			}  else if(vals[i].indexOf("Collection date:") != -1)
			{
				curTime = vals[i].split("Collection date:")[1].trim();
				if(curTime.indexOf("@") == -1)
				{
					var cSplit = curTime.split(" ");
					curTime = cSplit[0] + " " + cSplit[1] + " " + cSplit[2] + "@" + cSplit[3];
				}
				if (vals[i].indexOf("Collection sample:") != -1)
				{
					curSpec = vals[i].split("Collection date:")[0].split("Collection sample:")[1].trim();
				}
				listMicroSpec.push(curSpec + " @ " + timeFormat(curTime));
				listMicro.push("");
			} else if (vals[i].indexOf("Collection sample:") != -1)
			{
				curSpec = vals[i].split("Collection date:")[0].split("Collection sample:")[1].trim();
			} else if(vals[i].indexOf("Comment on specimen:") != -1)
			{
				listMicroSpec.pop();
				var np = vals[i+1];
				var cs = vals[i].split("Comment on specimen:")[1].trim();
				if(np.indexOf("Not Performed:") != -1)
				{
					cs += " " + np.split("Not Performed:")[0] + " Not Performed";
				}
				listMicroSpec.push(cs + " @ " + timeFormat(curTime));
			} else if(vals[i].indexOf("CULTURE RESULTS:") != -1)
			{
				var textS = "Culture: \n";
				textS += vals[i].split("CULTURE RESULTS:")[1].trim() + "\n";
				var onlyBlank = false;
				while(!onlyBlank)
				{
					i++;
					if(vals[i].trim() == "")
					{
						if(vals[i + 1].trim() == "" || vals[i + 1].indexOf("GRAM STAIN:") != -1 || vals[i + 1].indexOf("ANTIBIOTIC SUSCEPTIBILITY TEST RESULTS:") != -1 || vals[i + 1].indexOf("CULTURE RESULTS") != -1 || vals[i + 1].indexOf("=--=--=--=--=--=--=--=--=--=--=-") != -1)
							onlyBlank = true;	
					} else
					{
						textS += vals[i].trim() + "\n";
					}
				}
				var tlm = listMicro.pop();
				if(tlm != "")
				{
					listMicro.push(tlm + "\n" + textS);
				} else
				{
					listMicro.push(textS);
				}
			} else if(vals[i].indexOf("GRAM STAIN:") != -1)
			{
				var textS = "Gram stain: ";
				textS += vals[i].split("GRAM STAIN:")[1].trim();
				var onlyBlank = false;
				while(!onlyBlank)
				{
					i++;
					if(vals[i].trim() == "")
					{
						onlyBlank = true;
					} else
					{
						if(vals[i].indexOf("CALLED TO") != -1)
						{
								textS += vals[i].split("CALLED TO")[0].trim();
								onlyBlank = true;
						} else
						{
							textS += " " + vals[i].trim();
						}
					}
				}
				var tlm = listMicro.pop();
				if(tlm != "")
				{
					listMicro.push(tlm + "\n" + textS);
				} else
				{
					listMicro.push(textS);
				}
			} else if(vals[i].indexOf("Remark(s):") != -1)
			{
				var textS = "Lab Remark(s): ";
				textS += vals[i].split("Remark(s):")[1].trim();
				var onlyBlank = false;
				while(!onlyBlank)
				{
					i++;
					if(vals[i].trim() == "")
					{
						onlyBlank = true;
					} else
					{
						textS += " " + vals[i].trim();
					}
				}
				var tlm = listMicro.pop();
				if(tlm != "")
				{
					listMicro.push(tlm + "\n" + textS);
				} else
				{
					listMicro.push(textS);
				}
			} else if(vals[i].indexOf("Fungus/Yeast:") != -1)
			{
				var textS = "Fungus/Yeast:";
				textS += vals[i].split("Fungus/Yeast:")[1].trim();
				var onlyBlank = false;
				while(!onlyBlank)
				{
					i++;
					if(vals[i].trim() == "")
					{
						onlyBlank = true;
					} else
					{
						textS += " " + vals[i].trim();
					}
				}
				var tlm = listMicro.pop();
				if(tlm != "")
				{
					listMicro.push(tlm + "\n" + textS);
				} else
				{
					listMicro.push(textS);
				}
			} 
			else if(vals[i].indexOf("ANTIBIOTIC SUSCEPTIBILITY TEST RESULTS:") != -1)
			{
				var textS = "|||||||||||||||";
				textS += vals[i].split("ANTIBIOTIC SUSCEPTIBILITY TEST RESULTS:")[1].trim();
				i++;
				var onlyBlank = false;
				while(!onlyBlank)
				{
					i++;
					if(vals[i].trim() == "")
					{
						onlyBlank = true;
					} else
					{
						if(vals[i-1].trim() != "")
							textS += "\n";
						textS += vals[i];
					}
				}
				var tlm = listMicro.pop();
				if(tlm != "")
				{
					listMicro.push(tlm + "\n" + textS);
				} else
				{
					listMicro.push(textS);
				}
			} 
	}
	/* 
		Filling in special values
	*/
	// Calcium
	if("Calcium" in listVals && "Albumin" in listVals)
	{
		for(var i = 0; i < listVals["Corrected Calcium"].length; i++)
		{
			var t1 = listTime["Corrected Calcium"][i];
			var cv = parseFloat(listVals["Calcium"][i]);
			var alb1 = getTCV("Albumin",t1);
			var t2 = alb1[1];
			var alb = parseFloat(alb1[0]);
			var cc = (cv + 0.8*(4-alb));
			var ccS = cc.toFixed(1);
			listCrit["Corrected Calcium"][i] = "N";
			listVals["Corrected Calcium"][i] = ccS;
			if(ccS < 8.5)
				listCrit["Corrected Calcium"][i] = "L";	
			if(ccS > 10.5)
				listCrit["Corrected Calcium"][i] = "H";
			listUH["Corrected Calcium"][i] =  ccS + " (alb " + alb + " on " + t2.split("@")[0] + ")";
			if(ccS < 8.5 || ccS > 10.5)
				listUH["Corrected Calcium"][i] = "<span style='color: red; font-weight: bold'>" + ccS + " " + listCrit["Corrected Calcium"][i] + "</span>" + " (alb " + alb + " on " + t2.split("@")[0] + ")";
		}
	} else
	{
		deleteSpecial("Corrected Calcium");
	}	
	if("Retic %" in listVals && "HCT" in listVals)
	{
		for(var i = 0; i < listVals["Retic Index"].length; i++)
		{
			var t1 = listTime["Retic Index"][i];
			var rc = parseFloat(listVals["Retic %"][i]);
			var hctl = getTCV("HCT", t1);
			var hctr = parseFloat(hctl[0]);
			var rpi = (hctr/45)*rc;
			if(hctr < 15)
			{
				rpi /= 2.5;
			} else if(hctr < 25)
			{
				rpi /= 2.0;
			} else if(hctr < 35)
			{
				rpi /= 1.5;
			}		
			listVals["Retic Index"][i] = "" + rpi.toFixed(2) + "";
			listCrit["Retic Index"][i] = "N";
			listUH["Retic Index"][i] = rpi.toFixed(2) + " (HCT " + hctr + " on " + hctl[1].split("@")[0] + ")";
		}
	} else
	{
		deleteSpecial("Retic Index");
	}
	if("Osmolality" in listVals)
	{
		var t1 = listTime["Osmolality"][0];
		var osC = getTCV("Osmolality", t1, "SERUM||")[0];
		var sC = getTCV("SODIUM", t1, "SERUM||")[0];
		var bC = getTCV("UREA NITROGEN", t1, "SERUM||")[0];
		var gC = getTCV("Glucose", t1, "SERUM||")[0];
		if(osC != -1 && sC != -1 && bC != -1 && gC != -1)
		{
			for(var i = 0; i < listVals["Osm Gap"].length; i++)
			{
				t1 = listTime["Osm Gap"][i];
				var os1 = parseFloat(getTCV("Osmolality", t1, "SERUM||")[0]);
				var s1 = parseFloat(getTCV("SODIUM", t1, "SERUM||")[0]);
				var b1 = parseFloat(getTCV("UREA NITROGEN", t1, "SERUM||")[0]);
				var g1 = parseFloat(getTCV("Glucose", t1, "SERUM||")[0]);
				var eC = getTCV("Ethanol", t1, "SERUM||")[0];
				var eT = getTCV("Ethanol", t1, "SERUM||")[1];
				if(eC != -1)
				{
					var diff = Math.abs(timeToDate(t1) - timeToDate(eT));
					if(diff > msDay)
					{
						eC = -1;
					}
					try
					{
						if(eC.indexOf("<") != -1)
						{
							eC = -1;
						}
					} catch(e)
					{
					
					}
				}
				if(eC == -1)
					eC = 0;	
				eC = parseFloat(eC);
				var osmGap = os1 - 2*s1 - b1/2.8 - g1/18 - eC/4;		
				listVals["Osm Gap"][i] = "" + osmGap.toFixed(1) + "";
				listCrit["Osm Gap"][i] = "N";
				listUH["Osm Gap"][i] = osmGap.toFixed(1);
				if(eC != 0)
					listUH["Osm Gap"] += " (corrected for EtOH of " + eC + ")";
			}
		} else
		{
			deleteSpecial("Osm Gap");
		}		
	} else
	{
		deleteSpecial("Osm Gap");
	}
}
function fr() {}
function ff() {}
function loadFunction() {}
function myTrim(x) {
 return x.replace(/^\s+|\s+$/gm,'');
}
function timeToDate(curTime)
{
	return Date.parse(curTime.replace("@"," "));
}
function timeFormat(s)
{
	var d = new Date(timeToDate(s));
	var ds = (d.getMonth() +1) + "/" + d.getDate() + "/" + d.getFullYear() + " ";
	if(d.getHours() < 10)
		ds += "0";
	ds += d.getHours() + ":";
	if(d.getMinutes() < 10)
		ds += "0";
	return ds + d.getMinutes();
}
function getTCV(lab, t1, specimen)
{
	var minDif = -1;
	var minLoc = -1;
	var tcv = -1;
	if(lab in listTime)
	{
		for(var j = 0; j < listTime[lab].length; j++)
		{
			var diff = Math.abs(timeToDate(t1) - timeToDate(listTime[lab][j]));
			if(!specimen)
			{
				if(minDif == -1 || diff < minDif)
				{
					minLoc = j;
					minDif = diff;
					tcv = listVals[lab][j];
				}
			} else
			{
				if((minDif == -1 || diff < minDif) && specimen.indexOf(listSpecimen[lab][j] + "||") != -1)
				{
					minLoc = j;
					minDif = diff;
					tcv = listVals[lab][j];
				}
			}
		}
	} 
	if(tcv == -1)
		return [-1,-1,-1];
	return [tcv, listTime[lab][minLoc], minLoc];	
}
function templateSpecial(lab, base)
{
	if(!(lab in listVals))
	{
		listVals[lab] = new Array();
		listCrit[lab] = new Array();			
		listUH[lab] = new Array();
		listPH[lab] = new Array();
		listTime[lab] = new Array();
		listSpecimen[lab] = new Array();
		listComment[lab] = new Array();
	}
	var i = listVals[base].length - 1;
	listVals[lab].push(listVals[base][i]);
	listCrit[lab].push(listCrit[base][i]);
	listUH[lab].push(listUH[base][i]);
	listPH[lab].push(listPH[base][i]);
	listTime[lab].push(listTime[base][i]);
	listSpecimen[lab].push(listSpecimen[base][i]);
	listComment[lab].push(listComment[base][i]);
}
function deleteSpecial(lab)
{
	if(lab in listVals)
	{
		delete listVals[lab];
		delete listCrit[lab];
		delete listUH[lab];
		delete listPH[lab];
		delete listTime[lab];
		delete listSpecimen[lab];
		delete listComment[lab];
	}
}
</script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    const notesContainer = document.getElementById('notes-container');
    const addNoteButton = document.getElementById('add-note');
    const copyToClipboardButton = document.getElementById('copy-to-clipboard');
    const importTextarea = document.getElementById('import-textarea');
    const importButton = document.getElementById('import-button');
    const notesIndex = document.getElementById('notes-index');

    let notes = [];
    let sortable = null;

    // Load existing notes from the server
    const data = [{"title": "New Section Title", "content": ""}];
    notes = data.map(note => typeof note === 'string' ? {title: '', content: note} : note);
    renderNotes();


    function renderNotes() {
        notesContainer.innerHTML = '';
        notes.forEach((note, index) => {
            const noteElement = createNoteElement(note, index);
            notesContainer.appendChild(noteElement);
        });
        renderNotesIndex();
    }

    function renderNotesIndex() {
        if (sortable) {
            sortable.destroy();
        }
        notesIndex.innerHTML = '';
        notes.forEach((note, index) => {
            const title = note.title || 'Untitled Note';
            const li = document.createElement('li');
            li.textContent = title;
            li.dataset.index = index;
            li.addEventListener('click', () => {
                const noteElement = notesContainer.querySelector(`[data-index="${index}"]`);
                noteElement.scrollIntoView({ behavior: 'smooth' });
            });
            notesIndex.appendChild(li);
        });

        sortable = new Sortable(notesIndex, {
            animation: 150,
            onEnd: function () {
                const newNotes = [];
                Array.from(notesIndex.children).forEach(child => {
                    newNotes.push(notes[child.dataset.index]);
                });
                notes = newNotes;
                renderNotes();
            }
        });
    }


    function createNoteElement(note, index) {
        const noteDiv = document.createElement('div');
        noteDiv.classList.add('note');
        noteDiv.dataset.index = index;

        const titleInput = document.createElement('input');
        titleInput.type = 'text';
        titleInput.placeholder = 'New Section Title';
        titleInput.value = note.title;
        titleInput.dataset.index = index;
        titleInput.addEventListener('change', updateNote);

        const textarea = document.createElement('textarea');
        textarea.value = note.content;
        textarea.dataset.index = index;
        textarea.addEventListener('change', updateNote);

        const removeButton = document.createElement('button');
        removeButton.textContent = 'Remove';
        removeButton.dataset.index = index;
        removeButton.addEventListener('click', removeNote);
        
        noteDiv.appendChild(titleInput);
        noteDiv.appendChild(textarea);
        noteDiv.appendChild(removeButton);

        return noteDiv;
    }

    function addNote() {
        notes.push({title: 'New Section Title', content: ''});
        renderNotes();
    }

    function removeNote(event) {
        const index = event.target.dataset.index;
        notes.splice(index, 1);
        renderNotes();
    }

    function updateNote(event) {
        const index = event.target.dataset.index;
        const titleInput = notesContainer.querySelector(`[data-index="${index}"] input`);
        const textarea = notesContainer.querySelector(`[data-index="${index}"] textarea`);
        notes[index] = {
            title: titleInput.value,
            content: textarea.value
        };
        renderNotesIndex();
    }

    function importFromString() {
        const text = importTextarea.value;
        if (!text) {
            return;
        }

        const newNotes = [];
        const noteSections = text.split(/\n\s*\n/);

        noteSections.forEach(section => {
            const lines = section.split('\n');
            if (lines.length > 0) {
                const title = lines[0];
                const content = lines.slice(1).join('\n');
                newNotes.push({ title, content });
            }
        });

        notes = newNotes;
        renderNotes();
        importTextarea.value = '';
    }

    function copyToClipboard() {
        let textToCopy = '';
        notes.forEach((note, index) => {
            textToCopy += note.title + '\n' + note.content;
            if (index < notes.length - 1) {
                textToCopy += '\n\n';
            }
        });

        navigator.clipboard.writeText(textToCopy)
            .then(() => {
                notes = []; // Clear the notes array
                renderNotes(); // Re-render the UI
            })
            .catch(err => {
                console.error('Error copying notes: ', err);
                alert('Error copying notes.');
            });
    }


    function createNewNoteWithLabs(labs) {
        notes.push({title: 'Labs', content: labs});
        renderNotes();
    }

    addNoteButton.addEventListener('click', addNote);
    copyToClipboardButton.addEventListener('click', copyToClipboard);
    function handlePaste() {
        setTimeout(() => {
            fs();
            fr();
            const formattedLabs = document.getElementById('edtData').innerText;
            createNewNoteWithLabs(formattedLabs);
            modal.style.display = 'none';
        }, 100);
    }

    const modal = document.getElementById('lab-formatter-modal');
    const openLabFormatterButton = document.getElementById('open-lab-formatter');
    const closeButton = document.querySelector('.modal .close');

    openLabFormatterButton.addEventListener('click', () => {
        document.getElementById('clipb').value = '';
        document.getElementById('edtData').innerHTML = '';
        modal.style.display = 'block';
    });

    closeButton.addEventListener('click', () => {
        modal.style.display = 'none';
    });

    window.addEventListener('click', (event) => {
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    });
    importTextarea.addEventListener('paste', (event) => {
        event.preventDefault(); // Prevent the default paste behavior
        const pastedText = event.clipboardData.getData('text');
        importTextarea.value = pastedText;
        importFromString();
    });
    importButton.addEventListener('click', importFromString);
});
    </script>
</body>
</html>
